<!doctype html>
{% load static %}
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script rel="javascript" src="{% static "js/jquery-3.5.1.min.js" %}"></script>
  </head>
  <body>
    <h1>HTTP Tracker</h1><br>
    <button id="getbutton">Get Info</button><br>
    <script type="text/javascript">
      var urls = [
        "host",
        "ec2",
        "traceroute"
      ];
      function print(data, result, url, starttag, endtag){
        let now = new Date().toString();
        let urltag = document.getElementById(url + "result");
        let time = document.getElementById(url)
        let output = starttag + data + endtag;
        urltag.innerHTML = output;
        time.insertAdjacentHTML("beforeend", "<br><b id=" + now + ">Time: " + now + "</b><br>");
        urltag.insertAdjacentHTML("afterend", "<b>Result: " + result + "</b><br>");
      }
      $("#getbutton").click(function(){
        for(url of urls){
          let button = document.getElementById("getbutton");
          button.insertAdjacentHTML("afterend", "<br>" + "#".repeat(95) + "<br>");
          button.insertAdjacentHTML("afterend", "<br><b id=" + url + "result>Loading...</b><br>");         
          button.insertAdjacentHTML("afterend", "<b id=" + url + ">Url: " + url + "</b><br>");
          button.insertAdjacentHTML("afterend", "<br>" + "-".repeat(140) + "<br>");
          $.ajax({
            url: url,
            type: "GET",
            scriptCharset: "utf-8",
            success: function(data){
              let dataUrl = data["Url"]
              data = JSON.stringify(data, null, 2);
              console.log(dataUrl)
              print(data, "sucess", dataUrl, "<pre>", "</pre>");
            },
            error: function(data){
              let dataUrl = data["Url"]
              data = JSON.stringify(data, null, 2);
              print(data, "error", dataUrl, "<p>", "</p>");
            }
          });
        };
      });
    </script>
  </body>
</html>
